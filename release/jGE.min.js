const π=Math.PI,π2=2*π,π_hf=.5*π;function RandomClamped(){let t=Math.floor(100*Math.random())%2,e=Math.random();return(1==t?-1:1)*e}function GetEventPosition(t){var e,s;if(-1!=t.type.indexOf("touch"))try{var i=t.changedTouches[0];s=Math.floor(i.pageY),e=Math.floor(i.pageX)}catch(e){console.error(t,e)}else t.offsetX||0==t.offsetX?(e=t.offsetX,s=t.offsetY):console.error("获取鼠标坐标失败！");return new Vector2D(e,s)}class Vector2D{constructor(...t){let e,s;1==t.length?({x:e=0,y:s=0}=t[0]):[e=0,s=0]=t,this.speed=0,this.va=0,this._x=0,this._y=0,this.x=e,this.y=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=t,this.speed=this.Length(),this.va=Math.atan2(this.y,this.x)}set y(t){this._y=t,this.speed=this.Length(),this.va=Math.atan2(this.y,this.x)}Velocity(t,e){this._x=t*Math.cos(e),this._y=t*Math.sin(e),this.speed=t,this.va=e%π2}Copy(t){this.x=t.x,this.y=t.y}Cloen(){return new Vector2D(this)}Zero(){}isZero(){return 0===this.x&&0===this.y}Length(){return Math.sqrt(this.x*this.x+this.y*this.y)}LengthSq(){return this.x*this.x+this.y*this.y}Normalize(){var t=this.Length();return new Vector2D(this.x/t,this.y/t)}Dot(t){return this.x*t.x+this.y*t.y}Sign(t){}Perp(){}Truncate(t){}Distance(t){return Math.sqrt(this.DistanceSq(t))}DistanceSq(t){return Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2)}GetReverse(){}AddIn(t){return this.x+=t.x,this.y+=t.y,this}MinusIn(t){return this.x-=t.x,this.y-=t.y,this}MultiplyIn(t){return this.x*=t,this.y*=t,this}Add(t){return new Vector2D(this.x+t.x,this.y+t.y)}Minus(t){return new Vector2D(this.x-t.x,this.y-t.y)}Multiply(t){return new Vector2D(this.x*t,this.y*t)}Turn(t){return new Vector2D(this.x*Math.cos(t)-this.y*Math.sin(t),this.x*Math.sin(t)+this.y*Math.cos(t))}Equal(t){return this.x==t.x&&this.y==t.y}*[Symbol.iterator](){yield this.x,yield this.y}}class ShowObj extends Vector2D{constructor({x:t=0,y:e=0,angle:s=0,obj:i=null}={}){super({x:t,y:e});let h=Symbol("ObjManager"),a=this.Objects={rObj:[],uObj:[],items:new WeakSet};this.isDel=!1,this.angle=s,this.visible=!0,this[h]={add:function(t){a.items.has(t)||(t.isDel=!1,a.items.add(t),a.uObj.push(t),void 0!=t.render&&(void 0==t.index&&(t.index=1),Array.isArray(a.rObj[t.index])||(a.rObj[t.index]=[]),a.rObj[t.index].push(t)))},del:function(t){a.items.has(t)&&(t.isDel=!0,a.items.delete(t))}},this.add=((...t)=>(this[h].add.bind(this)(...t),this)),this.del=this[h].del.bind(this),null!=i&&i.forEach(t=>this.add(t))}update(t,e={x:0,y:0},s=0){this.visible&&(this.Objects.uObj.forEach((i,h)=>{i.isDel?this.Objects.uObj.splice(h,1):i.update(t,this.Add(e),this.angle+s)}),this._updateHandler&&this._updateHandler(t,new Vector2D(this),this.angle),this.Objects.rObj.map(t=>{t.forEach((e,s)=>{e.isDel&&t.splice(s,1)})}))}render(t){this.visible&&this.Objects.rObj.map(e=>{for(let s of e)s.isDel||s.render(t)})}*[Symbol.iterator](){for(let t=0;t<this.Objects.uObj.length;t++)yield this.Objects.uObj[t]}set updateHandler(t){t&&(this._updateHandler=t.bind(this))}}class $$tk_base{constructor({styleType:t=null,style:e=null,pos:s=new Vector2D,update:i=null}={}){this.fillStyle=null,this.strokeStyle=null,this.isAutoEnd=!1,this.angle=0,this.parentAngle=0,this.styleType=t,this.alpha=1,this.setStyle(e),this.pos=new Vector2D(...s),this.centerPoint=new Vector2D,this.updateHandler=i,this.isDel=!1}update(t,e,s){this._updateHandler&&this._updateHandler(t,e,s),this.parentAngle=s}render(t){}setStyle(t){let e="",s="";switch(this.styleType){case"fill":this.fillStyle=t;break;case"stroke":e=t;break;case"both":({fillStyle:s,strokeStylest:e}=t)}if(e){let[t,i=1,h="bull",a="miter"]=e.split(" ");this.strokeStyle=t,this.lineWidth=i,this.lineCap=h,this.lineJoin=a,this.fillStyle=s}}__draw(t,e,s){this.strokeStyle&&0==this.lineWidth||(t.save(),e&&e(t),t.globalAlpha=this.alpha,this.fillStyle&&(t.fillStyle=this.fillStyle,t.fill()),this.strokeStyle&&(t.strokeStyle=this.strokeStyle,t.lineWidth=1*this.lineWidth,t.lineCap=this.lineCap,t.lineJoin=this.lineJoin,this.isAutoEnd&&t.closePath(),t.stroke()),s&&s(t),t.restore())}set updateHandler(t){t&&(this._updateHandler=t.bind(this))}}class $tk_path extends $$tk_base{constructor({styleType:t="stroke",style:e="white",points:s=null,pos:i=[0,0],update:h=null}={}){if(!s||s.length<=0)return null;super({styleType:t,style:e,pos:i,update:h}),this.points=[];let a=null;this.isAutoEnd=-1==s[s.length-1]&&(a=s.pop(),!0),s.forEach(t=>{this.points.push(Array.isArray(t)?new Vector2D(t[0],t[1]):t)}),a&&s.push(a),this.setting={styleType:t,style:e,points:s,pos:i,update:h}}update(t,e,s){this.centerPoint=e.Add(this.pos.Turn(s)),super.update(t,e,s)}render(t){0==this.points.length||this.isDel||this.__draw(t,()=>this.toPath(t),!1)}toPath(t){t.beginPath(),this.dash&&t.setLineDash(this.dash),t.translate(this.centerPoint.x,this.centerPoint.y),t.rotate(this.angle+this.parentAngle),t.moveTo(this.points[0].x,this.points[0].y);for(let e of this.points)t.lineTo(e.x,e.y)}clone(){return new $tk_path(this.setting)}}class $tk_ellipse extends $$tk_base{constructor({styleType:t="stroke",style:e="white 1",points:s=null,pos:i=[0,0],update:h=null,a:a=0,b:n=0,r:r=0}={}){super({styleType:t,style:e,pos:i}),0!=r&&(a=r,n=r),this.a=a,this.b=n,this.r=Math.max(a,n),this.ratioX=a/this.r,this.ratioY=n/this.r,this.isAutoEnd=!0}update(t,e,s){this.centerPoint=e.Add(this.pos.Turn(s)),super.update(t,e,s)}render(t){this.__draw(t,()=>this.toPath(t),!1)}toPath(t){t.translate(this.centerPoint.x,this.centerPoint.y),t.rotate(this.angle+this.parentAngle),this.a!=this.b&&t.scale(this.ratioX,this.ratioY),t.beginPath(),t.arc(this.pos.x/this.ratioX,this.pos.y/this.ratioY,this.r,0,π2,!1)}}class $tk_arc extends $$tk_base{constructor({styleType:t="stroke",style:e="white 1",radius:s=100,cenPoin:i=[0,0],startAngle:h=0,endAngle:a=π2,anticlockwise:n=!0,startPoin:r=[0,0],endPoin:o=[0,0]}={}){super({styleType:t,style:e,pos:new Vector2D(...i)}),this.r=s,this.sAngle=h,this.eAngle=a,this.anticlockwise=n,this.sPoin=r,this.ePoin=o}update(t,e,s){this.centerPoint=e.Add(this.pos.Turn(s)),super.update(t,e,s)}render(t){this.__draw(t,()=>{t.translate(this.centerPoint.x,this.centerPoint.y),t.rotate(this.angle+this.parentAngle),t.beginPath(),this.sAngle!=this.eAngle?t.arc(this.pos.x,this.pos.y,this.r,this.sAngle,this.eAngle,this.anticlockwise):t.arcTo(...this.sPoin,...this.ePoin)},!1)}}class $tk_sprite{constructor({img:t={},pos:e=[0,0],area:s={width:t.width,height:t.height},sarea:i=null,update:h=null}={}){if(null==t)return null;this.img=t,this.barea=Object.freeze({width:s.width,height:s.height}),this.area=s,this.sarea=i,this.pos=new Vector2D(...e),this.dPos=new Vector2D,this.centerPoint=new Vector2D,this.updateHandler=h,this.angle=0,this.parentAngle=0,this.isDel=!1,this.alpha=1,t.width*t.height==0&&console.warn("加载的图像资源宽高异常：",t)}update(t,e,s){this.centerPoint=e.Add(this.pos.Turn(s)),this.dPos.Copy(this.centerPoint),this.dPos.x-=this.area.width/2,this.dPos.y-=this.area.height/2,this.parentAngle=s,this._updateHandler&&this._updateHandler(t,e,s)}render(t){t.save(),t.translate(this.centerPoint.x,this.centerPoint.y),t.rotate(this.angle+this.parentAngle),t.globalAlpha=this.alpha,this.sarea?t.drawImage(this.img,this.sarea.x,this.sarea.y,this.sarea.width,this.sarea.height,-this.area.width/2,-this.area.height/2,this.area.width,this.area.height):this.area&&t.drawImage(this.img,-this.area.width/2,-this.area.height/2,this.area.width,this.area.height),t.restore()}set updateHandler(t){t&&(this._updateHandler=t.bind(this))}scale(t){this.area.width=this.barea.width*t,this.area.height=this.barea.height*t}}class $tk_font extends $$tk_base{constructor({text:t="Text Unset",styleType:e="fill",style:s="white",font:i="22px 微软雅黑",angle:h=0,pos:a=[0,0],update:n=null}){super({styleType:e,style:s,pos:a,update:n}),this.font=i,this.angle=h,this.text=t}update(t,e,s){this.centerPoint=e.Add(this.pos.Turn(s)),super.update(t,e,s)}render(t){t.beginPath(),this.__draw(t,!1,()=>{t.font=this.font,t.translate(this.centerPoint.x,this.centerPoint.y),t.rotate(this.angle+this.parentAngle),t.textAlign="center",t.textBaseline="middle",this.fillStyle&&t.fillText(this.text,0,0),this.strokeStyle&&t.strokeText(this.text,0,0)})}text(t){this.text=t}set fontColor(t){this.fillStyle=t}}class $tk_video extends $tk_sprite{constructor(t){t.img=t.video,super(t),this.video=this.img,this.area.width=this.area.width||this.video.videoWidth,this.area.height=this.area.height||this.video.videoHeight;let e=this.area;this.barea=Object.freeze({width:e.width,height:e.height})}update(t,e,s){super.update(t,e,s),0==this.area.width&&(this.area.width=this.video.videoWidth),0==this.area.height&&(this.area.height=this.video.videoHeight)}pause(t){return!1===t?this.video.play():this.video.paused?this.video.play():this.video.pause()}loop(t){this.video.loop=t}silent(t){this.video.volume=t?1:0}}class $tk_animation extends $tk_sprite{constructor({img:t=null,pos:e=[0,0],area:s={x:0,y:0,width:t.width,height:t.height},sarea:i=null,fps:h=8,frame:a=null,farea:n={width:0,height:0},update:r=null}={}){if(!a||n.height<=0||n.width<=0)return console.warn(`动画配置，帧数设置错误，详情请参看配置：${JSON.stringify([...arguments])}\n            入参说明：area是当前图片的可视区，当多组sprite在同一个图片时，用于限定当前组的范围。若省略则用全图大小作范围。\n            sarea 是最终输出时的裁切区。若省略则输出结果不裁切。 【暂未实现】\n            farea 是帧长宽配置，本方法要求动画组的图片每帧尺寸一样。不可省略。\n            `),null;let o=[],{x:l,y:d}=s;for(let t=0;t<a;t++)o.push({x:l,y:d}),(l+=n.width)>=s.width&&(0,l=s.x,d+=n.height);super({img:t,pos:e,area:n,sarea:{x:o[0].x,y:o[0].y,width:n.width,height:n.height},update:r}),this.fps=Number(h),this.frame=a,this.curFrame=0,this.playTime=0,this.frames=o,this.timeSpan=1e3/this.fps,console.dir(this)}update(t,e,s){this.playTime+=t,this.playTime>=this.timeSpan&&(this.curFrame++,this.curFrame>=this.frame&&(this.curFrame=0),this.sarea.x=this.frames[this.curFrame].x,this.sarea.y=this.frames[this.curFrame].y,this.playTime%=this.timeSpan),super.update(t,e,s),this.parentAngle=s}}class jGE extends ShowObj{SetConfig(t){this.setting=t,this.run.width=this.setting.width,this.run.height=this.setting.height,this.run.bgColor="black",this.run.status="run"}Init(t){this.add(new EventManager(this)),this.add(new SceneManager(this)),this.add(this.ResourceManager=new ResourceManager(this));const e=this.run,s=this.setting;if(void 0!=t&&this.SetConfig(t),s.dom=document.createElement("canvas"),!s.dom.getContext)return null;s.dom.id=s.id,s.dom.width=s.width,s.dom.height=s.height,this.keyboards=new Set,this.__bind_helper(document.body,["keypress","keydown","keyup"],t=>{this.keyboards.forEach(e=>{e.keyHandle(t)})}),this.__bind_helper(s.dom,["click","touchstart"in s.dom?"touchstart":"mousedown","touchmove"in s.dom?"touchmove":"mousemove","touchend"in s.dom?"touchend":"mouseup","mousewheel"],t=>{e.curMousePoint=GetEventPosition(t),this.keyboards.forEach(s=>{s.pointHandle(t,e.curMousePoint)})}),e.context2D=s.dom.getContext("2d"),e.curMousePoint=new Vector2D,e.rendertime=0,e.curfram=0,e.aFps=0,e.vFps=0,e.fps_rc_time=0,this.update(16),this.render()}update(t){const e=this;0==t&&console.log(0);const s=this.run;"run"==s.status&&(s.timemark=new Date,this.managers.forEach(e=>e.update(t)),this.Objects.uObj.forEach((s,i)=>{s.isDel?this.Objects.uObj.splice(i,1):s.update(t,e)}),this.Objects.rObj.map(t=>{t.forEach((e,s)=>{e.isDel&&t.splice(s,1)})}),requestAnimationFrame(function(){let t=new Date-s.timemark;s.fps=Math.round(1e5*(s.rendertime-s.curfram)/t)/100,s.curfram=s.rendertime,s.aFps+=s.fps,s.fps_rc_time++,e.update(t)}))}render(){const t=this.run;if("run"!=t.status)return;t.context2D.clearRect(0,0,t.width,t.height),t.context2D.fillStyle=t.bgColor,t.context2D.fillRect(0,0,t.width,t.height),this.Objects.rObj.map(e=>{for(let s of e)s.isDel||s.render(t.context2D)}),t.rendertime++;const e=this;requestAnimationFrame(function(){e.render()})}_add(t){switch(t.Role){case"Manager":this.managers.add(t);break;case"Keyboard":this.super_add(t.VirtualKeyboard),this.keyboards.add(t);break;default:this.super_add(t)}}clean(){this.Objects.rObj=[],this.Objects.uObj=[]}GetDom(){return this.setting.dom}Pause(){this.run.status="run"==this.run.status?"pause":"run","run"==this.run.status&&(this.update(16),this.render())}GetArea(){return{width:this.setting.dom.width,height:this.setting.dom.height}}GetSetting(){return this.setting}IsInIt(t,e){const s=this.run.context2D;s.save(),e.toPath(s),s.closePath();let i=s.isPointInPath(t.x,t.y);return s.restore(),i}InitMessage(t){t.on=this.on.bind(this),t.one=this.one.bind(this),t.broadcast=this.broadcast.bind(this)}OnMouse(t,e,s){this.setting.dom.addEventListener(t,s?e.bind(s):e)}set backgroundColor(t){this.run.bgColor=t}__bind_helper(t,e,s){e.forEach(e=>t.addEventListener(e,s))}constructor(){super(),this.version=[4,5,5],this.setting={};this.run={};this.temp={},this.managers=new Set,this.super_add=this.add,this.add=this._add;let t={};arguments.length>0&&typeof arguments[0]==typeof{}&&(t=arguments[0]);var e=new GetConfig;for(let s in t)e[s]=t[s];this.SetConfig(e),this.on=(()=>{}),this.one=(()=>{}),this.broadcast=(()=>{}),this.get=(()=>{}),this.Init()}}class Manager{constructor(t,e="默认管理器"){this._jGE=t,t.run.iDBug&&console.log(`[%c报告%c] ${e}已启动。🐠🐠🐠🐠🐠。`,"color:green","color:black"),this.Role="Manager"}update(t){}}class EventManager extends Manager{constructor(t){super(t,"事件管理器"),this.eventQueue=new Map,this.eventOne=new Map,this.waitEventSet=new Set,this.watiEventObj=new Map,this.curEventSet=new Set,this.curEventObj=new Map,this._jGE=t,t.on=this.on.bind(this),t.one=this.one.bind(this),t.broadcast=this.broadcast.bind(this)}on(t,e){let s=this.eventQueue.get(t);s||this.eventQueue.set(t,s=[]),s.push(e)}one(t,e){let s=this.eventOne.get(t);s||this.eventOne.set(t,s=[]),s.push(e)}off(t){this.eventQueue.set(t,[])}broadcast(t,e){this.waitEventSet.add(t),this.watiEventObj.set(t,e)}update(t){this.waitEventSet.size>0&&(this.curEventSet=this.waitEventSet,this.curEventObj=this.watiEventObj,this.waitEventSet=new Set,this.watiEventObj=new Map);for(let t of this.eventQueue.keys())if(this.curEventSet.has(t)){let e=this.eventQueue.get(t),s=this.curEventObj.get(t);e.forEach(t=>{t(s)})}for(let t of this.eventOne.keys())if(this.curEventSet.has(t)){let e=this.eventOne.get(t),s=this.curEventObj.get(t);e.forEach(t=>{t(s)}),this.eventOne.delete(t)}this.curEventSet.clear(),this.curEventObj.clear()}}class ResourceManager extends Manager{constructor(t){super(t,"资源管理"),this.package=new Map,this.processing=new Map,this.packprocessing=Symbol(),this.Init(),this.isLoading=!1}Init(){}GetRes(t,e=""){let s=void 0;try{s=this.package.get(e).get(t)}catch(i){console.warn(`尝试获取资源失败(${e}-${t})，资源尚未加载。信息：${i}`),s=null}return s}LoadResPackage(t="",e=[]){this.package.has(t)||(this.package.set(t,new Map),this.package.get(t).set(this.packprocessing,0),this.processing.set(t,new Map)),e.forEach(e=>{this.LoadRes(t,e)}),this.isLoading=!0}LoadRes(t="default",{type:e="image",url:s="",id:i="",method:h="POST"}={}){let a=this.package.get(t),n=this.processing.get(t);this.package.has(t)&&a.has(i)?console.warn(`发现重复加载资源：${t}\\${i} 操作已停止。`):this.Ajax({url:s,dataType:e,method:h,onprogress:(t,e)=>{t=t<e?e:t,n.set(i,{l:e,t:t})}}).then(t=>{"json"!=e&&(t.id=i),a.set(i,t)}).catch(t=>{console.error("AjaxEror:",t)})}UnLoadResPackage(t){if(!this.package.has(t))return!1;var e=this.package.get(t);return e.forEach(t=>{null}),this.package.delete(t)}GetPkProcessing(t){this.package.get(t);let e=this.processing.get(t),s=e.get(this.packprocessing);if(1==s)return 1;Object.is(s,NaN)&&e.set(this.packprocessing,0);let[i,h]=[0,0];e.forEach(t=>{t&&(i+=t.l,h+=t.t)});let a=Math.ceil(1e3*i/h)/1e3;return e.set(this.packprocessing,a),1==a&&this._jGE.broadcast("jGE.Resource.Package.Finish",t),a}GetProcessing(){return this.processing.get(this.packprocessing)}UpdateProcessing(t=!0){let e=new Map;for(let t of this.package.keys())e.set(t,this.GetPkProcessing(t));if(t){let[t,s]=[0,0];for(let i of e.values())t+=i,s++;let i=t/s;return this.processing.set(this.packprocessing,i),i}return e}update(t,e){if(this.isLoading){let t=this.UpdateProcessing();Math.abs(t-1)<Number.EPSILON*Math.pow(2,2)&&(this.isLoading=!1),console.log(t),this.isLoading||this._jGE.broadcast("jGE.Resource.Finish")}}Ajax({method:t="POST",url:e="",data:s="",async:i=!0,ontimeout:h=12e3,responseType:a="text",dataType:n="json",onprogress:r=(()=>{})}={}){return new Promise(function(o,l){let d=new XMLHttpRequest;d.open(t,e,i),["image","video","audio"].includes(n)&&(a="blob","image"==n&&(n="img")),i&&(d.responseType=a),d.setRequestHeader("Content-type","application/x-www-four-urlencoded;charset=UTF-8"),d.ontimeout=h,d.onload=function(t){if(200==this.status||304==this.status){let t=null;"json"==n?t=JSON.parse(this.response):(t=document.createElement(n),"script"==n?(t.textContent=this.response,document.body.appendChild(t)):(t.src=window.URL.createObjectURL(this.response),t.onload=(e=>window.URL.revokeObjectURL(t.src)))),o.call(this,t)}else 404==this.status&&l.call(this,this.response)},d.onerror=l,d.onprogress=function(t){r.call(this,t.total,t.loaded)};try{d.send(s)}catch(t){l.call(this,t)}})}}class SceneManager extends Manager{constructor(t){super(t,"场景调度管理"),this.sceneCfg=new Map,this.nextScene="",this.Logo()}InitScene(t){t.forEach(t=>{})}PlayScene(){}Logo(){let t=function(){this.angle=0};console.log("开始Logo展示 🐉 jGE");let e="180px '微软雅黑'",s=new Vector2D(this._jGE.run.width/2,this._jGE.run.height/2),i=new ShowObj(s.Add({x:180,y:-20}));i.add(new $tk_font({text:"jGE",styleType:"fill",style:"#555555",font:e,pos:[4,4]})),i.add(new $tk_font({text:"jGE",styleType:"fill",style:"#808080",font:e,pos:[3,3]})),i.add(new $tk_font({text:"jGE",styleType:"fill",style:"#aaaaaa",font:e,pos:[2,2]})),i.add(new $tk_font({text:"jGE",styleType:"fill",style:"white",font:e,pos:[0,0]}));let h=new ShowObj(s.Add({x:-180,y:0}));h.add(new $tk_font({text:"🐉",styleType:"fill",style:"rgba(255,0,0,0.82)",font:"200px serif",pos:[0,-10],update:t})),h.add(new $tk_font({text:"🐉",styleType:"stroke",style:"rgba(255,255,255,0.8) 5",font:"200px serif",pos:[0,-10],update:t})),h.add(new $tk_path({styleType:"stroke",style:"#808080 20 round round",points:[[-130,-130],[130,-130],[130,130],[-130,130],-1],pos:[2,2],update:t})),h.add(new $tk_path({styleType:"stroke",style:"rgba(255,255,255,0.9) 20 round round",points:[[-130,-130],[130,-130],[130,130],[-130,130],-1],pos:[0,0],update:t}));{let t=!1,e=this._jGE,s=function(s){void 0==this.showtime&&(this.showtime=0),this.showtime+=s,this.showtime>=1500&&(this.isDel=!0,t||(t=!0,e.broadcast("jGE.Scene.Logo.End")))};i.updateHandler=s,h.updateHandler=s}this._jGE.add(i),this._jGE.add(h)}}class Keyboard extends Manager{constructor(t){super(t,"虚拟键盘"),this.Role="Keyboard",this.isEnable=!0,this.allkey=new Map,this._virtualkeyboard=new ShowObj}keyHandle(t){this.isEnable&&this.allkey.has(t.code)&&this.allkey.get(t.code).on(t)}pointHandle(t,e){if(!this.isEnable)return;let s={x:e.x,y:e.y,style:"point"};switch(t.type){case"mousemove":s.type="over";break;case"mousedown":s.type="keydown";break;case"mouseup":s.type="keyup";break;case"click":s.type="keypress";break;case"dblclick":s.type="dblclick";break;case"touchstart":s.type="keydown";break;case"touchmove":s.type="over";break;case"touchend":s.type="keyup";break;case"mousewheel":s.type="scroll",s.delta=t.deltaY}this.allkey.forEach(t=>t.on(s))}turnOn(){this.isEnable=!0}turnOff(){this.isEnable=!1}add(t){t._jGE=this._jGE,this.allkey.set(t.code,t),this.VirtualKeyboard.add(t)}get(t){return this.allkey.get(t)}get VirtualKeyboard(){return this._virtualkeyboard}SetPos(t){void 0!=t.x&&void 0!=t.y?this.VirtualKeyboard.Copy(t):Array.isArray(t)&&this.VirtualKeyboard.Copy({x:t[0],y:t[1]})}}class Key extends ShowObj{constructor({key:t="",code:e="",handler:s=null,upObjs:i=[],downObjs:h=null,hoverObj:a=null,actObj:n=null,x:r=0,y:o=0,angle:l=0}={}){super({x:r,y:o,angle:l}),this.handler=new Map,this.code=e,this.KEYSTATUS={Normal:Symbol(),Down:Symbol(),Hover:Symbol()},this.status=this.KEYSTATUS.Down,this.btShowObjs=new Map([[this.KEYSTATUS.Normal,i],[this.KEYSTATUS.Down,h],[this.KEYSTATUS.Hover,a]]),this.activeArea=n||i[0],this._jGE=null,null!==s&&addEventListener(type,s),this._changeStatus("keyup")}on(t){if("point"==t.style){if(!this._IsHit(t)){if(this.status!=this.KEYSTATUS.Hover)return;t.type="out"}t.code=this.code}if(this._changeStatus(t.type,t.style),!this.handler.has(t.type))return!1;this.handler.get(t.type).forEach(e=>{e(t)})}addEventListener(t,e){this.handler.has(t)||this.handler.set(t,new Set),this.handler.get(t).add(e)}removeEventListener(t){this.handler.has(t)&&this.handler.get(t).clear()}_changeStatus(t,e){if("keypress"==t)return;let s=this.status;switch(t){case"keydown":this.status=this.KEYSTATUS.Down;break;case"keyup":this.status="point"==e?this.KEYSTATUS.Hover:this.KEYSTATUS.Normal;break;case"over":this.status=this.KEYSTATUS.Hover;break;case"out":this.status=this.KEYSTATUS.Normal}s!=this.status&&(null!=this.btShowObjs.get(s)&&this.btShowObjs.get(s).forEach(t=>{this.del(t)}),null!=this.btShowObjs.get(this.status)&&this.btShowObjs.get(this.status).forEach(t=>{this.add(t)}))}_IsHit(t){return this._jGE.IsInIt(t,this.activeArea)}}class DragHelper{static InitDrag(t,{startCallback:e=null,moveCallback:s=null,endCallback:i=null,scrollCallback:h=null}={}){t._drag_status={startPos:{x:0,y:0},isDraging:!1},t.addEventListener("keydown",s=>{t._drag_status.startPos=new Vector2D(s),t._drag_status.isDraging=!0,e&&e.call(t)}),t.addEventListener("over",e=>{t._drag_status.isDraging&&s&&s.call(t,t._drag_status.startPos,e)}),t.addEventListener("keyup",e=>{i&&i.call(t,e),t._drag_status.isDraging=!1}),t.addEventListener("scroll",e=>{h&&h.call(t,e.delta)})}}function GetConfig(){return{id:"jGE_"+100*Math.random(),dom:null,width:700,height:750,fps:30,isRoundWorld:!0,keyHandler:function(t){}}}